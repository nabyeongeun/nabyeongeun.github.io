---
categories: [DB]
tags: [db,sql,oracle,tibero]
---

개발을 하다보면 DB 스키마를 문서로 작성해야 할 때가 있다.

특히 공공기관에서 발주한 사업을 하다보면 사업 담당 공무원이나 감리원이 집요하게 테이블 정의서를 요구하는데, 개발만 하기도 어렵고 나 혼자 개발하는 것도 아닌데, 그 모든 변동사항을 집계해서 문서로 만들기란 쉽지 않은 일이다.

그래서 별로 고급스킬은 아니지만, 한번 작성해두면 나중에 또 쓸 일이 있을 것 같아서 USER 내의 모든 테이블을 대상으로 테이블 정의서를 생성하는 스크립트를 작성했다.

```sql
-- Oracle
SELECT OWNER DBUSER_NAME, TABLE_NAME TABLENAME,
       (SELECT COMMENTS FROM USER_TAB_COMMENTS WHERE TABLE_NAME = A.TABLE_NAME) TABLENAME_한글,
       COLUMN_NAME COLUMN_NAME,
       (SELECT COMMENTS FROM USER_COL_COMMENTS WHERE TABLE_NAME = A.TABLE_NAME AND COLUMN_NAME = A.COLUMN_NAME) COLUMNNAME_한글,
       DATA_TYPE DATATYPE,
       DECODE(DATA_PRECISION, NULL, DATA_LENGTH, DATA_PRECISION) COLUMN_SIZE,
       DECODE(NULLABLE, 'Y', '', NULLABLE) IS_NULL,
       DECODE((SELECT COUNT(1) FROM USER_CONS_COLUMNS CC, USER_CONSTRAINTS C WHERE CC.CONSTRAINT_NAME = C.CONSTRAINT_NAME AND C.CONSTRAINT_TYPE='P' AND CC.TABLE_NAME = A.TABLE_NAME AND CC.COLUMN_NAME = A.COLUMN_NAME), 1, 'Y', NULL) IS_PK,
       DECODE((SELECT COUNT(1) FROM USER_IND_COLUMNS C WHERE A.TABLE_NAME = C.TABLE_NAME AND A.COLUMN_NAME = C.COLUMN_NAME), 1, 'Y', NULL) IS_IDX
FROM ALL_TAB_COLUMNS A WHERE OWNER = 'USERNAME_HERE'
ORDER BY TABLENAME, COLUMN_ID;

-- Tibero
SELECT OWNER DBUSER_NAME, TABLE_NAME TABLENAME,
       (SELECT COMMENTS FROM USER_TAB_COMMENTS WHERE TABLE_NAME = A.TABLE_NAME) TABLENAME_한글,
       COLUMN_NAME COLUMN_NAME,
       (SELECT COMMENTS FROM USER_COL_COMMENTS WHERE TABLE_NAME = A.TABLE_NAME AND COLUMN_NAME = A.COLUMN_NAME) COLUMNNAME_한글,
       DATA_TYPE DATATYPE,
       DECODE(DATA_PRECISION, 0, DATA_LENGTH, DATA_PRECISION) COLUMN_SIZE,
       DECODE(NULLABLE, 'Y', '', NULLABLE) IS_NULL,
       DECODE((SELECT COUNT(1) FROM USER_CONS_COLUMNS CC, USER_CONSTRAINTS C WHERE CC.CONSTRAINT_NAME = C.CONSTRAINT_NAME AND C.CONSTRAINT_TYPE='P' AND CC.TABLE_NAME = A.TABLE_NAME AND CC.COLUMN_NAME = A.COLUMN_NAME), 1, 'Y', NULL) IS_PK,
       DECODE((SELECT COUNT(1) FROM USER_IND_COLUMNS C WHERE A.TABLE_NAME = C.TABLE_NAME AND A.COLUMN_NAME = C.COLUMN_NAME), 1, 'Y', NULL) IS_IDX
FROM ALL_TAB_COLUMNS A WHERE OWNER = 'USERNAME_HERE'
ORDER BY TABLENAME, COLUMN_ID;
```
평소에 주석을 잘 단 사람일 수록 문서 작업 시간을 줄여줄 것이다.


